name: Log noir-starter traffic

on:
  schedule:
    # ‚è±Ô∏è CLEANUP: Runs once a week on Sunday, precisely at 00:00 UTC.
    - cron: "0 0 * * 0"
  workflow_dispatch:

jobs:
  noir-starter-traffic:
    runs-on: ubuntu-latest
    
    # üõ°Ô∏è PERMISSION: Grant explicit write permission for the commit step.
    permissions:
      contents: write 

    steps:
      # üöÄ UPGRADE: Use the latest stable checkout version (@v4).
      # The custom token is used here mainly for checking out (in case of private repo) 
      # and will be reused by the commit action for pushing.
      - uses: actions/checkout@v4 
        with:
          token: ${{ secrets.TRAFFIC_ACTION_TOKEN }}

      # Calculates traffic and stores it in CSV file
      - name: GitHub traffic 
        uses: sangonzal/repository-traffic-action@v.0.1.6
        env:
          # Custom token used here for reading the traffic API (requires 'repo' scope).
          TRAFFIC_ACTION_TOKEN: ${{ secrets.TRAFFIC_ACTION_TOKEN }}
          REPOSITORY_NAME: "noir-lang/noir-starter"
        
      # Commits files to repository
      - name: Commit changes
        uses: EndBug/add-and-commit@v9 # Use the latest stable version
        with:
          # ü§ñ CONSISTENCY: Use the official GitHub Actions Bot identity.
          author_name: github-actions[bot]
          author_email: 41898282+github-actions[bot]@users.noreply.github.com
          message: "docs(traffic): update noir-starter GitHub traffic data"
          add: "./traffic/*"
          # üîë SECURITY: Pass the custom token explicitly for push access.
          token: ${{ secrets.TRAFFIC_ACTION_TOKEN }}
          # The branch to commit to.
          ref: "traffic-noir-starter"
